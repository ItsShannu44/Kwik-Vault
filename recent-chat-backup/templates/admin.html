<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --table-bg: #f8f8f8;
            --table-hover: #ddd;
            --button-bg: linear-gradient(135deg, #4CAF50, #66BB6A);
            --button-hover: linear-gradient(135deg, #ff0000, #950000);
            --b-w:rgb(0, 0, 0);
        }
        
        [data-theme="Dark"] {
            --background-color: #131321;
            --text-color: #ffffff;
            --table-bg: #282a36;
            --table-hover: #6272a4;
            --button-bg: linear-gradient(135deg, #fb4453, #c20404);
            --button-hover: linear-gradient(135deg, #ff0000, #950000);
            --b-w:white;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-y: auto;
        }

        h1 {
            color: var(--text-color);
            text-align: center;
        }

        button {
            background: var(--button-bg);
            border: none;
            color: white;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: var(--button-hover);
            transform: scale(1.05);
        }

        table {
            width: 80%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--table-bg);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #44475a;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #44475a;
            color: #f8f8f2;
        }

        tbody tr:hover {
            background-color: var(--table-hover);
            transition: 0.3s;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            padding: 10px;
            border-radius: 5px;
        }
        .theme-toggle:hover
        {
            background: transparent;
        }
        .password-field {
        display: none; /* Initially hide password fields */
        }

        .password-text {
            display: inline; /* Initially show the text password */
        }

        .show-passwords .password-field {
            display: inline; /* When the 'show-passwords' class is added, show the password field */
        }

        .show-passwords .password-text {
            display: none; /* When the 'show-passwords' class is added, hide the text password */
        }
        #toggle-passwords
        {
            background: transparent;
            color:white;
        }
.dark-light 
{
width: 22px;
height: 22px;
color: var(--settings-icon-color);
flex-shrink: 0;

svg 
{
    width: 100%;
    fill: transparent;
    transition: 0.5s;
}
}
        /* New styles for message fetching form */
        .message-fetch {
            margin-top: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid grey;
        }

        .message-fetch input {
            margin: 5px;
            padding: 10px;
            width: 200px;
            border-radius: 5px;
            border: 1px solid #ccc;
            color:var(--b-w);
            background: transparent;
            font-size: 14px;
        }

        .message-fetch button {
            margin-top: 10px;
            padding: 10px 15px;
            background: #1650ff;
        }

        .messages-output {
            margin-top: 20px;
            width: 80%;
            max-height: 200px;
            overflow-y: auto;
            background: var(--table-bg);
            padding: 10px;
            border-radius: 5px;
            height:100vh;
            width:700px;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()"><div class="dark-light"><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" /></svg></div></button>
    <h1>Admin Panel</h1>
    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>Username</th>
                <th>Password<button id="toggle-passwords" onclick="toggleAllPasswords()">üëÅÔ∏è</button></th>
                <th>Delete users</th>
            </tr>
        </thead>
        <tbody>
            <h1>Welcome, Admin!</h1>
            <a href="{{ url_for('admin_logout') }}">
                <button>Logout</button>
            </a>
            {% for user in users %}
            <tr>
                <td>{{ user[0] }}</td>
                <td>{{ user[1] }}</td>
                <td>
                    <span class="password-field">{{ user[2] }}</span>
                    <span class="password-text" style="display:none;">{{ user[2] }}</span>
                </td>
                <td>
                    <form action="{{ url_for('delete_user', user_id=user['id']) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="message-fetch">
        <h2>Fetch Messages</h2>
        <div class="input-fields">
        <input type="text" id="sender" placeholder="Sender Username" required>
        <input type="text" id="receiver" placeholder="Receiver Username" required>
        <button onclick="fetchMessages()">Check Messages</button>
        <button onclick="ClearMessages()">Clear</button></div>
        <div class="messages-output" id="messagesOutput"></div>
    </div>
    <script>
function toggleAllPasswords() {
    const passwordFields = document.querySelectorAll('.password-field');
    const passwordTexts = document.querySelectorAll('.password-text');
    const button = document.getElementById('toggle-passwords');

    // Check if the first password field is currently hidden
    let isHidden = passwordFields[0].style.display === "none";

    // Toggle visibility of password fields
    passwordFields.forEach(field => {
        field.style.display = isHidden ? "inline" : "none"; // Toggle visibility
    });

    // Show or hide the text passwords
    passwordTexts.forEach(field => {
        text.style.display = isHidden ? "none" : "inline"; // Show the text passwords
    });

    // Toggle button text based on the state
    if (isHidden) {
        button.innerText = "Hide Passwords";
    } else {
        button.innerText = "Show Passwords";
    }
}


function toggleTheme() {
    const body = document.body;
    if (body.hasAttribute("data-theme")) {
        body.removeAttribute("data-theme");
    } else {
        body.setAttribute("data-theme", "Dark");
    }
}


function fetchMessages() {
    const sender = document.getElementById('sender').value;
    const receiver = document.getElementById('receiver').value;
    const messagesOutput = document.getElementById('messagesOutput');

    // Fetch messages from the server using the new route
    fetch(`/fetch_user_messages?sender=${sender}&receiver=${receiver}`)
        .then(response => response.json())
        .then(data => {
            messagesOutput.innerHTML = ''; // Clear previous messages
            if (data.length === 0) {
                messagesOutput.innerHTML = '<p>No messages found.</p>';
            } else {
                data.forEach(msg => {
                    messagesOutput.innerHTML += `<p><strong>${msg.sender}:</strong> ${msg.message} <em>(${msg.timestamp})</em></p>`;
                });
            }
        })
        .catch(error => {
            console.error('Error fetching messages:', error);
            messagesOutput.innerHTML = '<p>Error fetching messages. Please try again.</p>';
        });
}
function ClearMessages() {
    const messagesOutput = document.getElementById('messagesOutput');
    if (messagesOutput) {
        messagesOutput.innerHTML = '';
    }
}
    </script>
</body>
</html>
